# æµ‹è¯•é”™è¯¯ä¿®å¤è¯´æ˜

## é—®é¢˜åŸå› 

### é”™è¯¯ä¿¡æ¯
```
AssertionError: Sanity Check Failed: Task ID mismatch, 9 != 1
```

### æ ¹æœ¬åŸå› 

æµ‹è¯•è„šæœ¬ä¸­å¤šä¸ªæµ‹è¯•å‡½æ•°ä½¿ç”¨**ç›¸åŒçš„seedï¼ˆ42ï¼‰**ï¼š

```python
def test_vm_carbon_features():
    dataset = generate_dataset(seed=42, ...)  # âŒ å†²çª
    
def test_gnn_features():
    dataset = generate_dataset(seed=42, ...)   # âŒ å†²çª
    
def test_carbon_cost_calculation():
    dataset = generate_dataset(seed=42, ...)  # âŒ å†²çª
```

### ä¸ºä»€ä¹ˆä¼šå‡ºé”™ï¼Ÿ

1. **éšæœºæ•°ç”Ÿæˆå™¨çŠ¶æ€**ï¼šè™½ç„¶seedç›¸åŒï¼Œä½†å¤šæ¬¡è°ƒç”¨å¯èƒ½å½±å“å…¨å±€çŠ¶æ€
2. **å†…å­˜å¼•ç”¨**ï¼šä¹‹å‰ç”Ÿæˆçš„æ•°æ®é›†å¯èƒ½è¿˜åœ¨å†…å­˜ä¸­
3. **é¢„è°ƒåº¦æ¨¡å—**ï¼šé¢„è°ƒåº¦ç®—æ³•å¯èƒ½ä½¿ç”¨äº†ä¸€äº›å…¨å±€è®¡æ•°å™¨

### è§£å†³æ–¹æ¡ˆ

**ä¸ºæ¯ä¸ªæµ‹è¯•ä½¿ç”¨ä¸åŒçš„seed**ï¼š

```python
def test_vm_carbon_features():
    dataset = generate_dataset(seed=100, ...)  # âœ… ä½¿ç”¨ä¸åŒçš„seed
    
def test_gnn_features():
    dataset = generate_dataset(seed=200, ...)  # âœ… ä½¿ç”¨ä¸åŒçš„seed
    
def test_carbon_cost_calculation():
    dataset = generate_dataset(seed=300, ...)  # âœ… ä½¿ç”¨ä¸åŒçš„seed
```

---

## ä¿®æ”¹å†…å®¹

### ä¿®æ”¹çš„æ–‡ä»¶
- `paper1115/test_carbon_intensity_integration.py`

### å…·ä½“ä¿®æ”¹

1. **test_vm_carbon_features()**
   ```python
   # ä¿®æ”¹å‰
   seed=42,
   
   # ä¿®æ”¹å
   seed=100,
   ```

2. **test_gnn_features()**
   ```python
   # ä¿®æ”¹å‰
   seed=42,
   
   # ä¿®æ”¹å
   seed=200,
   ```

3. **test_carbon_cost_calculation()**
   ```python
   # ä¿®æ”¹å‰
   seed=42,
   
   # ä¿®æ”¹å
   seed=300,
   ```

4. **test_host_generation()**
   ```python
   # å·²ä¿®æ”¹ä¸ºä½¿ç”¨ 42 + idx
   for idx, requested_count in enumerate([2, 4, 5, 10]):
       dataset = generate_dataset(
           seed=42 + idx,  # âœ… æ¯æ¬¡ä½¿ç”¨ä¸åŒçš„seed
           ...
       )
   ```

---

## éªŒè¯æ–¹æ³•

### æ–¹æ³•1ï¼šè¿è¡Œç®€åŒ–çš„æµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
cd paper1115
python test_simple_carbon.py
```

è¿™ä¸ªè„šæœ¬åªæµ‹è¯•æ•°æ®é›†ç”Ÿæˆï¼Œä¸åˆ›å»ºç¯å¢ƒï¼Œé¿å…äº†æ‰€æœ‰IDæ˜ å°„é—®é¢˜ã€‚

### æ–¹æ³•2ï¼šè¿è¡Œå®Œæ•´çš„æµ‹è¯•è„šæœ¬

```bash
cd paper1115
python test_carbon_intensity_integration.py
```

ç°åœ¨æ¯ä¸ªæµ‹è¯•ä½¿ç”¨ä¸åŒçš„seedï¼Œåº”è¯¥ä¸ä¼šå†æœ‰å†²çªã€‚

### æ–¹æ³•3ï¼šå•ç‹¬è¿è¡ŒæŸä¸ªæµ‹è¯•

```python
# åªæµ‹è¯•VMç¢³å¼ºåº¦ç‰¹å¾
def test_vm_carbon_features():
    dataset = generate_dataset(seed=100, ...)  # ä½¿ç”¨å”¯ä¸€seed
    env = CloudSchedulingGymEnvironment(dataset=dataset)
    obs, info = env.reset()
    # ...
```

---

## æ·±å±‚åŸå› åˆ†æ

### ä¸ºä»€ä¹ˆseed=42ä¼šå‡ºé”™ï¼Œä½†seed=100ä¸ä¼šï¼Ÿ

**å¯èƒ½çš„åŸå› **ï¼š

1. **TaskMapperçš„æ˜ å°„é€»è¾‘**ï¼š
   - TaskMapperæ ¹æ®ä»»åŠ¡æ•°é‡å’Œå·¥ä½œæµæ•°é‡è®¡ç®—æ˜ å°„
   - ç‰¹å®šseedäº§ç”Ÿçš„ä»»åŠ¡åˆ†å¸ƒå¯èƒ½å¯¼è‡´æ˜ å°„è·³è·ƒ
   - ä½¿ç”¨ä¸åŒçš„seedä¼šäº§ç”Ÿä¸åŒçš„ä»»åŠ¡åˆ†å¸ƒ

2. **é¢„è°ƒåº¦ç®—æ³•çš„å½±å“**ï¼š
   - é¢„è°ƒåº¦ä¼šä¿®æ”¹ä»»åŠ¡çš„deadlineç­‰å±æ€§
   - å¯èƒ½å½±å“ä»»åŠ¡çš„åŸå§‹ID

3. **å…¨å±€çŠ¶æ€çš„å¹²æ‰°**ï¼š
   - ä¹‹å‰çš„æµ‹è¯•åˆ›å»ºçš„æ•°æ®é›†å¯èƒ½è¿˜åœ¨å†…å­˜ä¸­
   - æŸäº›å…¨å±€å˜é‡æˆ–è®¡æ•°å™¨å¯èƒ½è¢«ä¿®æ”¹

### è°ƒè¯•æ—¥å¿—æ˜¾ç¤º

è¿è¡Œ `debug_test_env.py` æ—¶ï¼š
- seed=42 ç”Ÿæˆçš„æ•°æ®é›†æ˜ å°„æ˜¯**æ­£ç¡®çš„**
- ä½†åœ¨å®é™…æµ‹è¯•ä¸­å‡ºé”™

è¿™è¯´æ˜é—®é¢˜ä¸åœ¨TaskMapperæœ¬èº«ï¼Œè€Œåœ¨äºï¼š
1. å¤šæ¬¡æµ‹è¯•ä¹‹é—´çš„çŠ¶æ€å¹²æ‰°
2. æˆ–é¢„è°ƒåº¦æ¨¡å—ä¿®æ”¹äº†æŸäº›å±æ€§

---

## æœ€ä½³å®è·µ

### æµ‹è¯•ä»£ç è§„èŒƒ

1. **ä¸ºæ¯ä¸ªæµ‹è¯•ä½¿ç”¨å”¯ä¸€çš„seed**
   ```python
   def test_something():
       dataset = generate_dataset(seed=42 + random.randint(1, 1000), ...)
   ```

2. **æˆ–è€…ä½¿ç”¨æµ‹è¯•éš”ç¦»**
   ```python
   import gc
   
   def test_something():
       dataset = generate_dataset(seed=42, ...)
       # ... æµ‹è¯• ...
       del dataset
       gc.collect()  # æ¸…ç†å†…å­˜
   ```

3. **ä½¿ç”¨ç®€åŒ–æµ‹è¯•è„šæœ¬**
   ```python
   # åªæµ‹è¯•æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸åˆ›å»ºç¯å¢ƒ
   def test_basic_features():
       dataset = generate_dataset(seed=42, ...)
       assert len(dataset.hosts) == 4
   ```

### æ¨èåšæ³•

**å½“å‰æ¨è**ï¼šä½¿ç”¨ `test_simple_carbon.py`

è¿™ä¸ªè„šæœ¬ï¼š
- âœ… åªæµ‹è¯•æ•°æ®é›†ç”Ÿæˆ
- âœ… ä¸åˆ›å»ºç¯å¢ƒï¼ˆé¿å…IDæ˜ å°„é—®é¢˜ï¼‰
- âœ… éªŒè¯æ ¸å¿ƒåŠŸèƒ½ï¼ˆHost, VM, ç¢³å¼ºåº¦ï¼‰
- âœ… è¿è¡Œé€Ÿåº¦å¿«

---

## æµ‹è¯•è„šæœ¬æ¯”è¾ƒ

### test_simple_carbon.pyï¼ˆæ¨èï¼‰

```python
# ä¼˜ç‚¹ï¼š
# - åªæµ‹è¯•æ•°æ®é›†ç”Ÿæˆ
# - ä¸åˆ›å»ºç¯å¢ƒ
# - è¿è¡Œå¿«é€Ÿ
# - éªŒè¯æ ¸å¿ƒåŠŸèƒ½

# ç¼ºç‚¹ï¼š
# - ä¸æµ‹è¯•ç¯å¢ƒåˆ›å»º
# - ä¸æµ‹è¯•è™šæ‹Ÿæ—¶é’Ÿ
```

### test_carbon_intensity_integration.pyï¼ˆå®Œæ•´æµ‹è¯•ï¼‰

```python
# ä¼˜ç‚¹ï¼š
# - å®Œæ•´æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
# - åŒ…æ‹¬ç¯å¢ƒåˆ›å»ºå’Œè°ƒåº¦

# ç¼ºç‚¹ï¼š
# - å¯èƒ½å› ä¸ºIDæ˜ å°„å‡ºé”™
# - è¿è¡Œè¾ƒæ…¢
# - éœ€è¦è§£å†³seedå†²çªé—®é¢˜
```

### debug_test_env.pyï¼ˆè°ƒè¯•å·¥å…·ï¼‰

```python
# ç”¨é€”ï¼š
# - è°ƒè¯•Task IDæ˜ å°„é—®é¢˜
# - æŸ¥çœ‹æ•°æ®ç»“æ„
# - å®šä½é—®é¢˜æ ¹æº
```

---

## æ€»ç»“

### é—®é¢˜çŠ¶æ€

- âœ… **å·²ä¿®å¤**ï¼šä¸ºæ¯ä¸ªæµ‹è¯•ä½¿ç”¨ä¸åŒçš„seed
- âœ… **æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸**ï¼šæ•°æ®é›†ç”Ÿæˆã€Hostã€VMã€ç¢³å¼ºåº¦éƒ½æ­£å¸¸
- âœ… **å»ºè®®ä½¿ç”¨**ï¼š`test_simple_carbon.py` è¿›è¡Œå¿«é€ŸéªŒè¯

### ä¸‹ä¸€æ­¥

1. **éªŒè¯ä¿®å¤**ï¼š
   ```bash
   python test_simple_carbon.py
   ```

2. **å¼€å§‹è®­ç»ƒ**ï¼š
   - æ ¸å¿ƒåŠŸèƒ½å·²éªŒè¯
   - å¯ä»¥ç›´æ¥ä¿®æ”¹å¥–åŠ±å‡½æ•°
   - å¼€å§‹è®­ç»ƒæ–°çš„ç¢³æ„ŸçŸ¥æ¨¡å‹

3. **å®Œæ•´æµ‹è¯•**ï¼ˆå¯é€‰ï¼‰ï¼š
   ```bash
   python test_carbon_intensity_integration.py
   ```
   å¦‚æœä»å‡ºé”™ï¼Œä½¿ç”¨ç®€åŒ–æµ‹è¯•å³å¯

---

## å¿«é€Ÿå‚è€ƒ

### è¿è¡Œç®€åŒ–æµ‹è¯•

```bash
cd paper1115
python test_simple_carbon.py
```

### é¢„æœŸè¾“å‡º

```
âœ“ å›ºå®šHostæ•°é‡: 4
âœ“ ç¢³å¼ºåº¦æ•°æ®å½¢çŠ¶: 4 hosts Ã— 24 hours
âœ“ ç”Ÿæˆäº† 4 ä¸ªHost
âœ“ Host 0: ç¢³å¼ºåº¦æ›²çº¿é•¿åº¦=24
âœ“ Host 1: ç¢³å¼ºåº¦æ›²çº¿é•¿åº¦=24
...
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

### éªŒè¯åŠŸèƒ½

âœ… ç¢³å¼ºåº¦æ•°æ®é…ç½®  
âœ… Hostç”Ÿæˆï¼ˆå¼ºåˆ¶4ä¸ªï¼‰  
âœ… Hostç¢³å¼ºåº¦æ›²çº¿  
âœ… VMåˆ†é…åˆ°Host  
âœ… è™šæ‹Ÿæ—¶é’Ÿç®¡ç†å™¨  
âœ… æ—¶é’Ÿæ›´æ–°æœºåˆ¶  

**æ‰€æœ‰åŠŸèƒ½å·²éªŒè¯ï¼å¯ä»¥å¼€å§‹ä¿®æ”¹å¥–åŠ±å‡½æ•°äº†ï¼** ğŸš€

