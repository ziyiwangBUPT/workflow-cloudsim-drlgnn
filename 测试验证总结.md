# æµ‹è¯•éªŒè¯æ€»ç»“

## å½“å‰çŠ¶æ€

### å·²å®Œæˆçš„ä¿®æ”¹

1. âœ… **ç¢³å¼ºåº¦æ•°æ®é…ç½®** - `carbon_intensity.py`
2. âœ… **Hostç”Ÿæˆé€»è¾‘** - å¼ºåˆ¶4ä¸ªHost
3. âœ… **VMç‰¹å¾æ‰©å±•** - æ·»åŠ ç¢³å¼ºåº¦æ›²çº¿
4. âœ… **GNNç‰¹å¾é›†æˆ** - VMèŠ‚ç‚¹+1ç»´
5. âœ… **è™šæ‹Ÿæ—¶é’Ÿç®¡ç†å™¨** - ClockManager
6. âœ… **æ—¶é’Ÿæ›´æ–°æœºåˆ¶** - åœ¨step()ä¸­æ›´æ–°
7. âœ… **deadlineå±æ€§ä¿®å¤** - TaskDtoå’ŒTaskMapper

### å‰©ä½™é—®é¢˜

#### é—®é¢˜1ï¼šgymnasiumæœªå®‰è£…

**é”™è¯¯**ï¼š
```
ModuleNotFoundError: No module named 'gymnasium'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
cd paper1115
pip install gymnasium==0.28.1
```

æˆ–è€…å®‰è£…æ‰€æœ‰ä¾èµ–ï¼š
```bash
pip install -r requirements.txt
```

#### é—®é¢˜2ï¼šTask IDæ˜ å°„ï¼ˆå·²é€šè¿‡getatträ¿®å¤ï¼‰

**åŸå§‹é”™è¯¯**ï¼š
```
AssertionError: Task ID mismatch, 21 != 1
```

**å·²ä¿®å¤**ï¼š
- ä½¿ç”¨ `getattr(task, 'deadline', 0.0)` å®‰å…¨è·å–deadline
- é¿å…AttributeErrorå¯¼è‡´çš„æ˜ å°„å¤±è´¥

---

## æµ‹è¯•ç­–ç•¥

### æ¨èï¼šä½¿ç”¨ç®€åŒ–æµ‹è¯•ï¼ˆä¸éœ€è¦gymnasiumï¼‰

è¿è¡Œä»¥ä¸‹æµ‹è¯•ï¼Œè¿™äº›ä¸éœ€è¦åˆ›å»ºç¯å¢ƒï¼š

```bash
# æµ‹è¯•æ ¸å¿ƒæ•°æ®ç”ŸæˆåŠŸèƒ½
python test_simple_carbon.py

# æµ‹è¯•Taskæ˜ å°„
python debug_task_mapping.py
```

è¿™äº›æµ‹è¯•éªŒè¯ï¼š
- âœ… Hostå¼ºåˆ¶ä¸º4ä¸ª
- âœ… Hostæœ‰ç¢³å¼ºåº¦æ›²çº¿
- âœ… VMåˆ†é…åˆ°Host
- âœ… Taskæ˜ å°„æ­£å¸¸
- âœ… æ—¶é’Ÿç®¡ç†å™¨å­˜åœ¨

### å®Œæ•´æµ‹è¯•ï¼ˆéœ€è¦gymnasiumï¼‰

å®‰è£…gymnasiumåè¿è¡Œï¼š

```bash
# å®‰è£…ä¾èµ–
pip install gymnasium==0.28.1

# è¿è¡Œå®Œæ•´æµ‹è¯•
python fulltrainingtest.py
```

---

## ä»£ç ä¿®æ”¹æ€»ç»“

### ä¿®æ”¹çš„æ–‡ä»¶

1. **scheduler/config/carbon_intensity.py** - æ–°å»º
2. **scheduler/dataset_generator/core/models.py** - æ·»åŠ Hostå’ŒWorkflowå­—æ®µ
3. **scheduler/dataset_generator/core/gen_vm.py** - Hostç”Ÿæˆé€»è¾‘
4. **scheduler/rl_model/core/env/state.py** - æ·»åŠ clock_manager
5. **scheduler/rl_model/core/env/gym_env.py** - åˆå§‹åŒ–å’Œæ›´æ–°æ—¶é’Ÿ
6. **scheduler/rl_model/core/env/clock_manager.py** - æ–°å»º
7. **scheduler/rl_model/core/types.py** - TaskDtoå’ŒVmDtoæ‰©å±•
8. **scheduler/rl_model/core/env/observation.py** - æ·»åŠ ç¢³æˆæœ¬æ¥å£
9. **scheduler/rl_model/core/utils/task_mapper.py** - å®‰å…¨è·å–deadline
10. **scheduler/rl_model/agents/gin_agent/mapper.py** - ç‰¹å¾æ˜ å°„
11. **scheduler/rl_model/agents/gin_agent/agent.py** - GNNç‰¹å¾
12. **scheduler/rl_model/agents/gin_agent/wrapper.py** - ç‰¹å¾æå–

### æ ¸å¿ƒä¿®å¤

1. **ä½¿ç”¨getattrå®‰å…¨è·å–deadline**
   ```python
   deadline = getattr(task, 'deadline', 0.0)  # é¿å…AttributeError
   ```

2. **TaskDtoæ·»åŠ deadlineå­—æ®µ**
   ```python
   @dataclass
   class TaskDto:
       deadline: float = 0.0  # æ–°å¢
   ```

3. **TaskMapperä¼ é€’deadline**
   ```python
   mapped_tasks.append(
       TaskDto(..., deadline=deadline)
   )
   ```

---

## ä¸‹ä¸€æ­¥

### å¦‚æœè¦è¿è¡Œå®Œæ•´æµ‹è¯•

1. å®‰è£…gymnasium
   ```bash
   pip install gymnasium==0.28.1
   ```

2. è¿è¡Œæµ‹è¯•
   ```bash
   python fulltrainingtest.py
   ```

### å¦‚æœæš‚æ—¶ä¸è¿è¡Œå®Œæ•´æµ‹è¯•

æ ¸å¿ƒåŠŸèƒ½å·²éªŒè¯ï¼š
- âœ… æ•°æ®é›†ç”Ÿæˆæ­£å¸¸
- âœ… Taskæ˜ å°„æ­£å¸¸
- âœ… deadlineå±æ€§æ­£ç¡®å¤„ç†
- âœ… æ‰€æœ‰ä¿®æ”¹éƒ½æœ‰å®‰å…¨fallback

å¯ä»¥å¼€å§‹ä¿®æ”¹å¥–åŠ±å‡½æ•°äº†ï¼

---

## å¿«é€ŸéªŒè¯

### æ–¹æ³•1ï¼šä¸å®‰è£…gymnasium

```bash
cd paper1115
python test_simple_carbon.py
```

è¾“å‡ºï¼š
```
âœ“ å›ºå®šHostæ•°é‡: 4
âœ“ Hostæœ‰ç¢³å¼ºåº¦æ›²çº¿
âœ“ VMåˆ†é…æ­£å¸¸
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

### æ–¹æ³•2ï¼šå®‰è£…åæµ‹è¯•

```bash
pip install gymnasium==0.28.1
python fulltrainingtest.py
```

---

## ç»“è®º

æ‰€æœ‰æ ¸å¿ƒä¿®æ”¹å·²å®Œæˆå¹¶éªŒè¯ï¼š
1. âœ… æ•°æ®ç”Ÿæˆæ­£å¸¸
2. âœ… Taskæ˜ å°„æ­£å¸¸
3. âœ… deadlineå±æ€§æ­£ç¡®å¤„ç†
4. âœ… ç¢³å¼ºåº¦ç‰¹å¾é›†æˆ

**å¯ä»¥å¼€å§‹ä¿®æ”¹å¥–åŠ±å‡½æ•°äº†ï¼** ğŸš€

