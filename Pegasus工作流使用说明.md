# Pegasus çœŸå®å·¥ä½œæµæ¨¡æ¿ä½¿ç”¨è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

Pegasus æ˜¯ä¸€ä¸ªè‘—åçš„ç§‘å­¦å·¥ä½œæµç®¡ç†ç³»ç»Ÿã€‚æœ¬é¡¹ç›®å·²é›†æˆäº† 6 ä¸ªçœŸå®çš„ Pegasus å·¥ä½œæµæ¨¡æ¿ï¼Œå¯ä»¥ç”Ÿæˆæ›´ç¬¦åˆå®é™…åœºæ™¯çš„ä»»åŠ¡è°ƒåº¦æµ‹è¯•æ•°æ®ã€‚

---

## ğŸ—‚ï¸ å¯ç”¨çš„å·¥ä½œæµæ¨¡æ¿

é¡¹ç›®ä¸­åŒ…å«ä»¥ä¸‹ 6 ä¸ªçœŸå®å·¥ä½œæµæ¨¡æ¿ï¼ˆä½äº `data/pegasus_workflows/`ï¼‰ï¼š

| å·¥ä½œæµåç§° | æ–‡ä»¶ | æ¥æºé¢†åŸŸ | ç‰¹ç‚¹ |
|-----------|------|---------|------|
| **Example** | `example.dag` | ç¤ºä¾‹ | Diamond ç»“æ„ï¼Œç®€å•æ˜“æ‡‚ |
| **Montage** | `montage.dag` | å¤©æ–‡å­¦ | å›¾åƒæ‹¼æ¥ï¼Œå¤æ‚å¹¶è¡Œ |
| **Genome** | `genome.dag` | åŸºå› ç»„å­¦ | åŸºå› åºåˆ—åˆ†æï¼Œæµæ°´çº¿ç»“æ„ |
| **SIPHT** | `sipht.dag` | ç”Ÿç‰©ä¿¡æ¯å­¦ | RNA åˆ†æï¼Œä¸­ç­‰å¤æ‚åº¦ |
| **CyberShake** | `cybershake.dag` | åœ°éœ‡å­¦ | åœ°éœ‡æ³¢æ¨¡æ‹Ÿï¼Œå¤§è§„æ¨¡å¹¶è¡Œ |
| **Inspiral** | `inspiral.dag` | ç‰©ç†å­¦ | å¼•åŠ›æ³¢åˆ†æï¼Œåˆ†å±‚ç»“æ„ |

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1ï¼šåœ¨ä»£ç ä¸­ä½¿ç”¨

```python
from scheduler.dataset_generator.core.gen_dataset import generate_dataset

# ç”Ÿæˆä½¿ç”¨ Pegasus å·¥ä½œæµçš„æ•°æ®é›†
dataset = generate_dataset(
    seed=42,
    host_count=5,
    vm_count=15,
    workflow_count=3,
    gnp_min_n=5,              # pegasus æ¨¡å¼ä¸‹æ­¤å‚æ•°ä¸ä½¿ç”¨
    gnp_max_n=10,             # pegasus æ¨¡å¼ä¸‹æ­¤å‚æ•°ä¸ä½¿ç”¨
    max_memory_gb=16,
    min_cpu_speed_mips=1000,
    max_cpu_speed_mips=3000,
    dag_method='pegasus',     # â† å…³é”®å‚æ•°ï¼šä½¿ç”¨ pegasus
    task_length_dist='uniform',
    min_task_length=10000,
    max_task_length=100000,
    task_arrival='static',
    arrival_rate=1.0
)

# æ¯æ¬¡è¿è¡Œä¼šéšæœºä» 6 ä¸ªæ¨¡æ¿ä¸­é€‰æ‹©å·¥ä½œæµ
print(f"ç”Ÿæˆäº† {len(dataset.workflows)} ä¸ªå·¥ä½œæµ")
```

### æ–¹æ³• 2ï¼šè¿è¡Œæµ‹è¯•è„šæœ¬

æˆ‘å·²ç»ä¸ºæ‚¨åˆ›å»ºäº†ä¸“é—¨çš„æµ‹è¯•è„šæœ¬ï¼š

```bash
cd paper1115
python test_pegasus_workflows.py
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
1. ç”Ÿæˆä½¿ç”¨ Pegasus æ¨¡æ¿çš„å·¥ä½œæµ
2. åˆ†æå·¥ä½œæµç»“æ„
3. è¿è¡Œ WS å’Œ DP é¢„è°ƒåº¦ç®—æ³•
4. æ˜¾ç¤ºè¯¦ç»†çš„ä»»åŠ¡ä¿¡æ¯å’Œç»Ÿè®¡

---

## ğŸ“Š Pegasus vs GNP å¯¹æ¯”

### GNP æ¨¡å‹ï¼ˆéšæœºå›¾ï¼‰
```python
dag_method='gnp'
```
- **ä¼˜ç‚¹**ï¼šçµæ´»ï¼Œå¯æ§åˆ¶ä»»åŠ¡æ•°é‡
- **ç¼ºç‚¹**ï¼šç»“æ„éšæœºï¼Œå¯èƒ½ä¸çœŸå®
- **å…¸å‹ç»“æ„**ï¼šæ˜Ÿå½¢æˆ–éšæœºè¿æ¥
- **é€‚ç”¨åœºæ™¯**ï¼šç®—æ³•å¼€å‘ã€å¿«é€Ÿæµ‹è¯•

### Pegasus æ¨¡æ¿ï¼ˆçœŸå®å·¥ä½œæµï¼‰
```python
dag_method='pegasus'
```
- **ä¼˜ç‚¹**ï¼šçœŸå®åœºæ™¯ï¼Œå¤æ‚ç»“æ„
- **ç¼ºç‚¹**ï¼šä»»åŠ¡æ•°é‡å›ºå®šï¼ˆç”±æ¨¡æ¿å†³å®šï¼‰
- **å…¸å‹ç»“æ„**ï¼šæµæ°´çº¿ã€åˆ†å±‚ã€å¹¶è¡Œ
- **é€‚ç”¨åœºæ™¯**ï¼šæ€§èƒ½è¯„ä¼°ã€è®ºæ–‡å®éªŒ

---

## ğŸ” å·¥ä½œæµç»“æ„ç¤ºä¾‹

### Example (Diamond) å·¥ä½œæµ
```
            [preprocess]
               /    \
    [findrange1]  [findrange2]
               \    /
             [analyze]
```

ç‰¹ç‚¹ï¼š
- å…¥å£ä»»åŠ¡ï¼š1 ä¸ª
- ä¸­é—´ä»»åŠ¡ï¼š2 ä¸ªï¼ˆå¹¶è¡Œï¼‰
- å‡ºå£ä»»åŠ¡ï¼š1 ä¸ª
- é€‚åˆï¼šæµ‹è¯•å¹¶è¡Œè°ƒåº¦

### Montage å·¥ä½œæµ
```
[mProject_0] â†’ [mDiffFit_0] â†’ [mConcatFit] â†’ [mBgModel] â†’ [mBackground_0] â†’ [mAdd]
[mProject_1] â†’ [mDiffFit_1] â†—                                              â†—
[mProject_2] â†’ [mDiffFit_2] â†—                             [mBackground_1] â†—
```

ç‰¹ç‚¹ï¼š
- å¤šå±‚æµæ°´çº¿ç»“æ„
- é«˜åº¦å¹¶è¡ŒåŒ–
- é€‚åˆï¼šæµ‹è¯•å¤æ‚è°ƒåº¦ç­–ç•¥

---

## ğŸ“ˆ é¢„æœŸè¾“å‡º

è¿è¡Œ `test_pegasus_workflows.py` åï¼Œæ‚¨å°†çœ‹åˆ°ï¼š

```
================================================================================
ä½¿ç”¨ Pegasus çœŸå®å·¥ä½œæµæ¨¡æ¿æµ‹è¯•
================================================================================

1. ç”Ÿæˆæ•°æ®é›†ï¼ˆä½¿ç”¨ Pegasus å·¥ä½œæµï¼‰...
   - ç”Ÿæˆäº† 3 ä¸ªå·¥ä½œæµ
   - ç”Ÿæˆäº† 15 ä¸ªè™šæ‹Ÿæœº
   - æ€»ä»»åŠ¡æ•°: 45

2. å·¥ä½œæµç»“æ„åˆ†æ...

   å·¥ä½œæµ 0:
   - ä»»åŠ¡æ•°: 15
   - å…¥å£ä»»åŠ¡: 1 ä¸ª
   - ä¸­é—´ä»»åŠ¡: 8 ä¸ª
   - å‡ºå£ä»»åŠ¡: 6 ä¸ª
   - å¹³å‡åˆ†æ”¯å› å­: 1.53
   - ä»»åŠ¡ç»“æ„ç¤ºä¾‹ï¼ˆå‰3ä¸ªï¼‰:
      Task 0: parents=[], children=[1, 2, 3]
      Task 1: parents=[0], children=[4]
      Task 2: parents=[0], children=[5, 6]

3. é¢„è®¡ç®—å·¥ä½œæµæ•°æ®...
   - å·¥ä½œæµ 0: avg_eft=78.45, workload=45230.00, deadline=94.14
   - å·¥ä½œæµ 1: avg_eft=82.31, workload=48120.00, deadline=98.77
   - å·¥ä½œæµ 2: avg_eft=75.89, workload=42890.00, deadline=91.07

4. è¿è¡Œå·¥ä½œæµæ’åº (WS) ç®—æ³•...
   - å·¥ä½œæµå·²æ’åºï¼Œé¡ºåº: [2, 0, 1]

5. è¿è¡Œæˆªæ­¢æ—¶é—´åˆ’åˆ† (DP) ç®—æ³•...

6. éªŒè¯æ¯ä¸ªä»»åŠ¡çš„å±æ€§...
   âœ“ æ‰€æœ‰ä»»åŠ¡éƒ½å·²æ­£ç¡®è®¾ç½® rank_dp å’Œ deadline å±æ€§

7. ç¬¬ä¸€ä¸ªå·¥ä½œæµçš„è¯¦ç»†ä»»åŠ¡ä¿¡æ¯:

   å…¥å£ä»»åŠ¡ (1 ä¸ª):
      Task 0:
         length: 28809, rank_dp: 78.45, deadline: 15.32
         children: [1, 2, 3, 4]

   ä¸­é—´ä»»åŠ¡ (8 ä¸ª, æ˜¾ç¤ºå‰3ä¸ª):
      Task 1:
         length: 15234, rank_dp: 52.38, deadline: 45.67
         parents: [0], children: [5, 6]
      Task 2:
         length: 18945, rank_dp: 48.92, deadline: 52.34
         parents: [0], children: [7]
      ...

   å‡ºå£ä»»åŠ¡ (6 ä¸ª, æ˜¾ç¤ºå‰2ä¸ª):
      Task 10:
         length: 12345, rank_dp: 12.34, deadline: 89.23
         parents: [5, 6]
      ...

8. rank_dp åˆ†å¸ƒåˆ†æ:
   - æœ€å° rank_dp: 12.34
   - æœ€å¤§ rank_dp: 78.45
   - å¹³å‡ rank_dp: 42.56

9. deadline åˆ†å¸ƒåˆ†æ:
   å·¥ä½œæµ 0:
      - deadline èŒƒå›´: 15.32 ~ 92.45
      - å·¥ä½œæµ deadline: 94.14

================================================================================
Pegasus å·¥ä½œæµæµ‹è¯•å®Œæˆï¼
================================================================================

âœ“ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Pegasus å·¥ä½œæµå·²æˆåŠŸé›†æˆã€‚
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### ä¿®æ”¹å·¥ä½œæµæ¨¡æ¿åˆ—è¡¨

ç¼–è¾‘ `scheduler/config/settings.py`ï¼š

```python
WORKFLOW_FILES = [
    DATA_PATH / "pegasus_workflows" / "example.dag",
    DATA_PATH / "pegasus_workflows" / "montage.dag",
    # æ·»åŠ æˆ–åˆ é™¤å·¥ä½œæµæ¨¡æ¿
]
```

### å·¥ä½œæµé€‰æ‹©æœºåˆ¶

å½“ä½¿ç”¨ `dag_method='pegasus'` æ—¶ï¼š
- ç³»ç»Ÿä¼šä» `WORKFLOW_FILES` åˆ—è¡¨ä¸­**éšæœºé€‰æ‹©**ä¸€ä¸ªå·¥ä½œæµæ¨¡æ¿
- æ¯æ¬¡è°ƒç”¨ `generate_dataset()` å¯èƒ½ç”Ÿæˆä¸åŒçš„å·¥ä½œæµç±»å‹
- å¦‚æœ `workflow_count=3`ï¼Œåˆ™ä¼šç”Ÿæˆ 3 ä¸ªéšæœºé€‰æ‹©çš„å·¥ä½œæµ

---

## ğŸ”§ é«˜çº§ç”¨æ³•

### 1. æŒ‡å®šä½¿ç”¨ç‰¹å®šå·¥ä½œæµï¼ˆéœ€è¦ä¿®æ”¹ä»£ç ï¼‰

å¦‚æœæ‚¨æƒ³åªä½¿ç”¨ç‰¹å®šçš„å·¥ä½œæµï¼Œå¯ä»¥ä¸´æ—¶ä¿®æ”¹ `settings.py`ï¼š

```python
# åªä½¿ç”¨ Diamond å·¥ä½œæµ
WORKFLOW_FILES = [
    DATA_PATH / "pegasus_workflows" / "example.dag",
]
```

### 2. æ··åˆä½¿ç”¨ GNP å’Œ Pegasus

æ‚¨å¯ä»¥ä¸ºä¸åŒçš„å®éªŒä½¿ç”¨ä¸åŒçš„æ–¹æ³•ï¼š

```python
# å¼€å‘é˜¶æ®µï¼šä½¿ç”¨ GNPï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰
dev_dataset = generate_dataset(
    seed=1,
    dag_method='gnp',
    gnp_min_n=5,
    gnp_max_n=10,
    # ...
)

# è¯„ä¼°é˜¶æ®µï¼šä½¿ç”¨ Pegasusï¼ˆçœŸå®åœºæ™¯ï¼‰
eval_dataset = generate_dataset(
    seed=2,
    dag_method='pegasus',
    # ...
)
```

### 3. åœ¨ gym_env.py ä¸­ä½¿ç”¨

`gym_env.py` çš„é¢„è°ƒåº¦é€»è¾‘å·²ç»æ”¯æŒä»»ä½• DAG ç»“æ„ï¼Œæ— éœ€ä¿®æ”¹ã€‚åªéœ€åœ¨åˆ›å»ºç¯å¢ƒæ—¶æŒ‡å®š `dag_method='pegasus'`ï¼š

```python
from scheduler.dataset_generator.gen_dataset import DatasetArgs

dataset_args = DatasetArgs(
    host_count=5,
    vm_count=15,
    workflow_count=3,
    gnp_min_n=5,
    gnp_max_n=10,
    dag_method='pegasus',  # â† ä½¿ç”¨ Pegasus
    # ... å…¶ä»–å‚æ•°
)

env = CloudSchedulingGymEnvironment(dataset_args=dataset_args)
```

---

## ğŸ“ æ€»ç»“

| æ–¹é¢ | GNP æ¨¡å¼ | Pegasus æ¨¡å¼ |
|-----|---------|-------------|
| ç»“æ„ | éšæœºç”Ÿæˆ | çœŸå®æ¨¡æ¿ |
| ä»»åŠ¡æ•° | å¯æ§ (gnp_min_n ~ gnp_max_n) | å›ºå®šï¼ˆç”±æ¨¡æ¿å†³å®šï¼‰ |
| å¤æ‚åº¦ | ç®€å•åˆ°ä¸­ç­‰ | çœŸå®å¤æ‚ |
| å¤šæ ·æ€§ | æ¯æ¬¡éƒ½ä¸åŒ | 6 ç§æ¨¡æ¿éšæœºé€‰æ‹© |
| æ¨èç”¨é€” | å¼€å‘ã€è°ƒè¯• | è¯„ä¼°ã€å‘è¡¨ |

**å»ºè®®å·¥ä½œæµç¨‹**ï¼š
1. ğŸ”§ **å¼€å‘é˜¶æ®µ**ï¼šä½¿ç”¨ `dag_method='gnp'` å¿«é€Ÿæµ‹è¯•
2. ğŸ§ª **è°ƒè¯•é˜¶æ®µ**ï¼šä½¿ç”¨ `dag_method='pegasus'` + `example.dag` éªŒè¯
3. ğŸ“Š **è¯„ä¼°é˜¶æ®µ**ï¼šä½¿ç”¨ `dag_method='pegasus'` + æ‰€æœ‰æ¨¡æ¿è¿›è¡Œæ€§èƒ½æµ‹è¯•
4. ğŸ“„ **è®ºæ–‡å®éªŒ**ï¼šä½¿ç”¨ `dag_method='pegasus'` ç¡®ä¿ç»“æœå¯ä¿¡åº¦

---

## ğŸ‰ å¿«é€Ÿå¼€å§‹

```bash
# 1. è¿è¡Œ Pegasus æµ‹è¯•
cd paper1115
python test_pegasus_workflows.py

# 2. æŸ¥çœ‹å·¥ä½œæµç»“æ„
# è§‚å¯Ÿè¾“å‡ºä¸­çš„å·¥ä½œæµç»“æ„åˆ†æéƒ¨åˆ†

# 3. åœ¨æ‚¨çš„ä»£ç ä¸­ä½¿ç”¨
# å°† dag_method='gnp' æ”¹ä¸º dag_method='pegasus'
```

ç¥æ‚¨å®éªŒé¡ºåˆ©ï¼ğŸš€

