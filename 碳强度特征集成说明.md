# ç¢³å¼ºåº¦ç‰¹å¾é›†æˆè¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®å·²æˆåŠŸé›†æˆç¢³å¼ºåº¦ç‰¹å¾ï¼Œæ¨¡ä»¿ `ecmws-experiments` é¡¹ç›®å¤„ç†ç”µä»·çš„æ–¹å¼ï¼Œå°†è°ƒåº¦ç›®æ ‡ä»æœ€å°åŒ–"èƒ½è€—"æ‰©å±•åˆ°æœ€å°åŒ–"ç¢³æˆæœ¬"ã€‚

**æ ¸å¿ƒå®šä¹‰**ï¼š
```
ç¢³æˆæœ¬ = èƒ½è€— Ã— ç¢³å¼ºåº¦
```

---

## ğŸ¯ å®ç°çš„åŠŸèƒ½

### 1. ç¢³å¼ºåº¦æ•°æ®ç®¡ç†

âœ… **å›ºå®š4ä¸ªHostçš„ç¢³å¼ºåº¦æ›²çº¿**
- æ¯ä¸ªHostå¯¹åº”ä¸€ä¸ª24å°æ—¶ç¢³å¼ºåº¦æ›²çº¿
- æ•°æ®ç»“æ„ï¼š`list[list[float]]`ï¼Œshape = (4ä¸ªHost, 24å°æ—¶)
- ä½ç½®ï¼š`scheduler/config/carbon_intensity.py`

âœ… **ç¢³å¼ºåº¦æ•°æ®æ¥æº**
- å‚è€ƒ `ecmws-experiments/utils/given_data.py` çš„ç”µä»·æ•°æ®ç»“æ„
- æš‚æ—¶ä½¿ç”¨ç›¸åŒçš„æ•°å€¼ï¼Œå¯ä»¥åç»­æ‰‹åŠ¨ä¿®æ”¹ä¸ºçœŸå®ç¢³å¼ºåº¦å€¼

### 2. Hostç”Ÿæˆé€»è¾‘ä¿®æ”¹

âœ… **å¼ºåˆ¶ç”Ÿæˆ4ä¸ªHost**
- ä¿®æ”¹ `generate_hosts()` å‡½æ•°ï¼Œå¿½ç•¥è¾“å…¥å‚æ•°ï¼Œå§‹ç»ˆç”Ÿæˆ4ä¸ªHost
- æ¯ä¸ªHostè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç¢³å¼ºåº¦æ›²çº¿
- æ–‡ä»¶ï¼š`scheduler/dataset_generator/core/gen_vm.py`

### 3. è™šæ‹Ÿæ—¶é’Ÿç®¡ç†ç³»ç»Ÿ

âœ… **å·¥ä½œæµçº§åˆ«çš„è™šæ‹Ÿæ—¶é’Ÿ**
- æ¯ä¸ªå·¥ä½œæµç»´æŠ¤ç‹¬ç«‹çš„è™šæ‹Ÿæ—¶é’Ÿï¼Œä»0:00å¼€å§‹
- æ”¯æŒæ—¶é’Ÿæ¨è¿›å’ŒæŸ¥è¯¢
- æ–‡ä»¶ï¼š`scheduler/rl_model/core/env/clock_manager.py`

âœ… **Workflowç±»æ‰©å±•**
- æ·»åŠ  `virtual_clock` å±æ€§
- æä¾› `advance_clock()` å’Œ `get_current_hour()` æ–¹æ³•
- æ–‡ä»¶ï¼š`scheduler/dataset_generator/core/models.py`

### 4. VMç‰¹å¾æ‰©å±•

âœ… **VmDtoæ‰©å±•**
- æ·»åŠ  `host_id`ï¼šHostçš„ID
- æ·»åŠ  `host_carbon_intensity_curve`ï¼šHostçš„ç¢³å¼ºåº¦æ›²çº¿
- æä¾› `get_carbon_intensity_at()` æ–¹æ³•
- æ–‡ä»¶ï¼š`scheduler/rl_model/core/types.py`

âœ… **VmObservationæ‰©å±•**
- æ·»åŠ  `host_id` å’Œ `host_carbon_intensity_curve`
- æä¾› `get_carbon_intensity_at()` æ–¹æ³•
- æ–‡ä»¶ï¼š`scheduler/rl_model/core/env/observation.py`

### 5. GNNç‰¹å¾é›†æˆ

âœ… **VMèŠ‚ç‚¹ç‰¹å¾æ‰©å±•**
- åŸæœ‰ç‰¹å¾ï¼š`[å®Œæˆæ—¶é—´, é€Ÿåº¦å€’æ•°, èƒ½è€—ç‡]`
- æ–°ç‰¹å¾ï¼š`[å®Œæˆæ—¶é—´, é€Ÿåº¦å€’æ•°, èƒ½è€—ç‡, ç¢³å¼ºåº¦]`
- æ–‡ä»¶ï¼š`scheduler/rl_model/agents/gin_agent/agent.py`

âœ… **ç‰¹å¾æ˜ å°„æ›´æ–°**
- æ›´æ–° `GinAgentMapper` çš„ map/unmap æ–¹æ³•
- æ›´æ–° `GinAgentObsTensor` æ•°æ®ç±»
- æ–‡ä»¶ï¼š`scheduler/rl_model/agents/gin_agent/mapper.py`

âœ… **ç‰¹å¾æå–**
- åœ¨ `map_observation()` ä¸­æå–ç¢³å¼ºåº¦ç‰¹å¾
- ä½¿ç”¨VMå®Œæˆæ—¶é—´å¯¹åº”çš„ç¢³å¼ºåº¦å€¼
- æ–‡ä»¶ï¼š`scheduler/rl_model/agents/gin_agent/wrapper.py`

### 6. ç¢³æˆæœ¬è®¡ç®—æ¥å£

âœ… **EnvObservation.carbon_cost()**
- è®¡ç®—æ€»ç¢³æˆæœ¬ï¼š`âˆ‘(èƒ½è€— Ã— ç¢³å¼ºåº¦)`
- ä¸ºå¥–åŠ±å‡½æ•°é¢„ç•™çš„æ¥å£
- æ–‡ä»¶ï¼š`scheduler/rl_model/core/env/observation.py`

---

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### 1. è·å–ç¢³å¼ºåº¦æ•°æ®

```python
from scheduler.config.carbon_intensity import (
    CARBON_INTENSITY_DATA,
    get_carbon_intensity_at_time,
    calculate_carbon_cost
)

# è·å–Host 0åœ¨ç¬¬10å°æ—¶çš„ç¢³å¼ºåº¦
carbon_intensity = get_carbon_intensity_at_time(host_id=0, time_seconds=10*3600)

# è®¡ç®—ç¢³æˆæœ¬
carbon_cost = calculate_carbon_cost(
    energy_consumption=1000.0,  # èƒ½è€—
    host_id=0,                  # Host ID
    start_time=0,               # å¼€å§‹æ—¶é—´
    end_time=3600               # ç»“æŸæ—¶é—´
)
```

### 2. ä½¿ç”¨ç¢³æˆæœ¬æ¥å£

```python
from scheduler.rl_model.core.env.observation import EnvObservation

# åœ¨ç¯å¢ƒä¸­è®¡ç®—ç¢³æˆæœ¬
obs = env.reset()
carbon_cost = obs.carbon_cost()  # è·å–å½“å‰çŠ¶æ€çš„æ€»ç¢³æˆæœ¬
```

### 3. ä¿®æ”¹å¥–åŠ±å‡½æ•°ï¼ˆç¤ºä¾‹ï¼‰

åœ¨ `scheduler/rl_model/agents/gin_agent/wrapper.py` ä¸­ä¿®æ”¹ `step()` æ–¹æ³•ï¼š

```python
def step(self, action: int) -> tuple[np.ndarray, SupportsFloat, bool, bool, dict[str, Any]]:
    mapped_action = self.map_action(action)
    obs, _, terminated, truncated, info = super().step(mapped_action)
    assert isinstance(obs, EnvObservation)
    mapped_obs = self.map_observation(obs)

    # è®¡ç®—å¤šç›®æ ‡å¥–åŠ±
    makespan_reward = -(obs.makespan() - self.prev_obs.makespan()) / obs.makespan()
    energy_reward = -(obs.energy_consumption() - self.prev_obs.energy_consumption()) / obs.energy_consumption()
    
    # æ–°å¢ï¼šç¢³æˆæœ¬å¥–åŠ±
    carbon_cost = obs.carbon_cost()
    prev_carbon_cost = self.prev_obs.carbon_cost()
    carbon_reward = -(carbon_cost - prev_carbon_cost) / max(carbon_cost, 1e-8)
    
    # ç»¼åˆå¥–åŠ±ï¼ˆæƒé‡å¯è°ƒæ•´ï¼‰
    reward = makespan_reward + energy_reward + carbon_reward

    self.prev_obs = obs
    return mapped_obs, reward, terminated, truncated, info
```

---

## ğŸ“Š æ•°æ®ç»“æ„

### ç¢³å¼ºåº¦æ•°æ®æ ¼å¼

```python
CARBON_INTENSITY_DATA = [
    # Host 0: é«˜ç¢³å¼ºåº¦åŒºåŸŸï¼ˆç…¤ç”µä¸ºä¸»ï¼‰
    [0.15, 0.10, 0.11, 0.11, 0.19, 0.22, 0.19, 0.11, 0.12, 0.07, 0.08, 0.10, 0.14, ...],
    
    # Host 1: ä½ç¢³å¼ºåº¦åŒºåŸŸï¼ˆæ°´ç”µ/æ ¸ç”µä¸ºä¸»ï¼‰
    [0.07, 0.08, 0.09, 0.07, 0.13, 0.14, 0.13, 0.13, 0.12, 0.12, 0.09, 0.09, 0.09, ...],
    
    # Host 2: ä¸­ç­‰ç¢³å¼ºåº¦åŒºåŸŸï¼ˆæ··åˆèƒ½æºï¼‰
    [0.10, 0.09, 0.11, 0.11, 0.09, 0.09, 0.10, 0.10, 0.15, 0.15, 0.15, 0.13, 0.12, ...],
    
    # Host 3: é«˜ç¢³å¼ºåº¦åŒºåŸŸï¼ˆå¤©ç„¶æ°”ä¸ºä¸»ï¼‰
    [0.13, 0.13, 0.15, 0.15, 0.17, 0.19, 0.21, 0.21, 0.21, 0.18, 0.18, 0.17, 0.13, ...],
]
```

### è™šæ‹Ÿæ—¶é’Ÿæœºåˆ¶

```python
# æ‰¹å¤„ç†æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæ—¶é’Ÿ
# å‡è®¾ï¼šæ‰€æœ‰å·¥ä½œæµåœ¨è°ƒåº¦å¼€å§‹æ—¶è™šæ‹Ÿæ—¶é’Ÿéƒ½è®¾ä¸º 0:00ï¼ˆå‡Œæ™¨0ç‚¹ï¼‰

workflow.virtual_clock = 0.0  # åˆå§‹åŒ–ä¸º0ç§’
workflow.advance_clock(3600)  # æ¨è¿›1å°æ—¶
current_hour = workflow.get_current_hour()  # è·å–å½“å‰å°æ—¶ï¼ˆ0-23ï¼‰
```

---

## ğŸ” GNNç‰¹å¾ç©ºé—´å˜åŒ–

### ä»»åŠ¡ç‰¹å¾ï¼ˆ4ç»´ï¼‰
- `task_state_scheduled`: æ˜¯å¦å·²è°ƒåº¦
- `task_state_ready`: æ˜¯å¦å°±ç»ª
- `task_length`: ä»»åŠ¡è®¡ç®—é‡
- `task_normalized_deadline`: å½’ä¸€åŒ–çš„å­æˆªæ­¢æ—¶é—´

### VMç‰¹å¾ï¼ˆ4ç»´ â†’ æ–°å¢1ç»´ï¼‰
- `vm_completion_time`: VMå®Œæˆæ—¶é—´
- `1 / vm_speed`: é€Ÿåº¦å€’æ•°
- `vm_energy_rate`: èƒ½è€—ç‡
- **`vm_carbon_intensity`**: ç¢³å¼ºåº¦ â­ æ–°å¢

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | çŠ¶æ€ |
|------|---------|------|
| `scheduler/config/carbon_intensity.py` | âœ… æ–°å¢ï¼šç¢³å¼ºåº¦æ•°æ®é…ç½® | å®Œæˆ |
| `scheduler/dataset_generator/core/models.py` | âœ… Hostæ·»åŠ carbon_intensity_curve<br>âœ… Workflowæ·»åŠ virtual_clock | å®Œæˆ |
| `scheduler/dataset_generator/core/gen_vm.py` | âœ… å¼ºåˆ¶ç”Ÿæˆ4ä¸ªHost | å®Œæˆ |
| `scheduler/rl_model/core/types.py` | âœ… VmDtoæ·»åŠ ç¢³å¼ºåº¦å­—æ®µ | å®Œæˆ |
| `scheduler/rl_model/core/env/observation.py` | âœ… VmObservationæ·»åŠ ç¢³å¼ºåº¦<br>âœ… æ·»åŠ carbon_cost()æ–¹æ³• | å®Œæˆ |
| `scheduler/rl_model/core/env/clock_manager.py` | âœ… æ–°å¢ï¼šè™šæ‹Ÿæ—¶é’Ÿç®¡ç†å™¨ | å®Œæˆ |
| `scheduler/rl_model/agents/gin_agent/mapper.py` | âœ… æ·»åŠ ç¢³å¼ºåº¦åˆ°map/unmap | å®Œæˆ |
| `scheduler/rl_model/agents/gin_agent/agent.py` | âœ… VMç‰¹å¾æ·»åŠ ç¢³å¼ºåº¦ç»´åº¦ | å®Œæˆ |
| `scheduler/rl_model/agents/gin_agent/wrapper.py` | âœ… æå–ç¢³å¼ºåº¦ç‰¹å¾ | å®Œæˆ |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. Hostæ•°é‡é™åˆ¶
- é¡¹ç›®ç°åœ¨å¼ºåˆ¶ç”Ÿæˆ4ä¸ªHost
- å¦‚æœåœ¨ `generate_dataset()` ä¸­è®¾ç½® `host_count` ä¸ä¸º4ï¼Œä¼šè¾“å‡ºè­¦å‘Šä½†ä»ç”Ÿæˆ4ä¸ªHost

### 2. ç¢³å¼ºåº¦æ•°æ®ä¿®æ”¹
å¦‚éœ€ä¿®æ”¹ç¢³å¼ºåº¦æ•°æ®ï¼Œè¯·ç¼–è¾‘ï¼š
```
paper1115/scheduler/config/carbon_intensity.py
```

ä¿®æ”¹ `gen_carbon_intensity_data()` å‡½æ•°ä¸­çš„æ•°å€¼ï¼š
```python
host1 = [0.15, 0.10, 0.11, ...]  # ä¿®æ”¹è¿™é‡Œçš„24ä¸ªæ•°å€¼
host2 = [0.07, 0.08, 0.09, ...]
host3 = [0.10, 0.09, 0.11, ...]
host4 = [0.13, 0.13, 0.15, ...]
```

### 3. å¥–åŠ±å‡½æ•°ä¿®æ”¹
å½“å‰**æœªä¿®æ”¹**å¥–åŠ±å‡½æ•°ï¼Œä»ä½¿ç”¨åŸæœ‰çš„ `makespan + energy`ã€‚

è¦æ·»åŠ ç¢³æˆæœ¬ï¼Œè¯·ä¿®æ”¹ `wrapper.py` çš„ `step()` æ–¹æ³•ï¼Œå‚è€ƒä¸Šè¿°ç¤ºä¾‹ä»£ç ã€‚

### 4. æ—¶é—´å¯¹é½
- ä½¿ç”¨ `workflow.arrival_time` ä½œä¸ºç»å¯¹æ—¶é—´åŸºå‡†
- ä»»åŠ¡çš„ç»å¯¹æ—¶é—´ = `workflow.arrival_time + task.start_time`
- ç¢³å¼ºåº¦æ ¹æ®ä»»åŠ¡æ‰§è¡Œæ—¶é—´åŠ¨æ€è®¡ç®—

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### åŸºç¡€åŠŸèƒ½æµ‹è¯•

```python
# æµ‹è¯•ç¢³å¼ºåº¦ç‰¹å¾æ˜¯å¦æ­£ç¡®åŠ è½½
from scheduler.config.carbon_intensity import CARBON_INTENSITY_DATA, FIXED_NUM_HOSTS

print(f"Hostæ•°é‡: {FIXED_NUM_HOSTS}")
print(f"ç¢³å¼ºåº¦æ•°æ®å½¢çŠ¶: {len(CARBON_INTENSITY_DATA)} x {len(CARBON_INTENSITY_DATA[0])}")

# æµ‹è¯•Hostç”Ÿæˆ
from scheduler.dataset_generator.core.gen_dataset import generate_dataset

dataset = generate_dataset(
    seed=42,
    host_count=5,  # ä¼šè¢«å¿½ç•¥ï¼Œå¼ºåˆ¶ç”Ÿæˆ4ä¸ª
    vm_count=15,
    workflow_count=3,
    # ... å…¶ä»–å‚æ•°
)

print(f"å®é™…ç”Ÿæˆçš„Hostæ•°é‡: {len(dataset.hosts)}")
for host in dataset.hosts:
    print(f"Host {host.id}: ç¢³å¼ºåº¦æ›²çº¿é•¿åº¦ = {len(host.carbon_intensity_curve)}")
```

### GNNç‰¹å¾æµ‹è¯•

```python
# æµ‹è¯•GNNç‰¹å¾æ˜¯å¦åŒ…å«ç¢³å¼ºåº¦
env = CloudSchedulingGymEnvironment(dataset_args=...)
obs, info = env.reset()

# æ£€æŸ¥VMè§‚å¯Ÿä¸­çš„ç¢³å¼ºåº¦
for vm_obs in obs.vm_observations:
    carbon_intensity = vm_obs.get_carbon_intensity_at(0)
    print(f"VM {vm_obs}: ç¢³å¼ºåº¦ = {carbon_intensity}")
```

### ç¢³æˆæœ¬è®¡ç®—æµ‹è¯•

```python
# æµ‹è¯•ç¢³æˆæœ¬è®¡ç®—
env = CloudSchedulingGymEnvironment(dataset_args=...)
obs, info = env.reset()

# æ‰§è¡Œå‡ ä¸ªæ­¥éª¤
for _ in range(10):
    action = env.action_space.sample()
    obs, reward, done, truncated, info = env.step(action)

# è®¡ç®—ç¢³æˆæœ¬
total_carbon_cost = obs.carbon_cost()
total_energy = obs.energy_consumption()
print(f"æ€»èƒ½è€—: {total_energy}")
print(f"æ€»ç¢³æˆæœ¬: {total_carbon_cost}")
```

---

## ğŸš€ ä¸‹ä¸€æ­¥å·¥ä½œ

### å¾…å®ç°åŠŸèƒ½

1. **ä¿®æ”¹å¥–åŠ±å‡½æ•°**
   - å½“å‰å¥–åŠ±å‡½æ•°ä»ä¸º `makespan + energy`
   - éœ€è¦æ·»åŠ ç¢³æˆæœ¬ç»„ä»¶ï¼š`+ carbon_reward`
   - ä½ç½®ï¼š`scheduler/rl_model/agents/gin_agent/wrapper.py`

2. **æƒé‡è°ƒä¼˜**
   - ç¡®å®š makespanã€energyã€carbon ä¸‰è€…çš„æƒé‡
   - å»ºè®®ä» `[0.33, 0.33, 0.34]` å¼€å§‹å°è¯•

3. **è®­ç»ƒéªŒè¯**
   - ä½¿ç”¨æ–°ç‰¹å¾é‡æ–°è®­ç»ƒæ¨¡å‹
   - éªŒè¯æ¨¡å‹æ˜¯å¦èƒ½å­¦ä¼šç¢³æ„ŸçŸ¥è°ƒåº¦ç­–ç•¥

---

## ğŸ“ æ¶æ„è®¾è®¡è¯´æ˜

### æ—¶é—´ç®¡ç†æ–¹å¼

**æ‰¹å¤„ç† + è™šæ‹Ÿæ—¶é’Ÿ**ï¼š
- æ‰€æœ‰å·¥ä½œæµåœ¨è°ƒåº¦å¼€å§‹æ—¶å·²çŸ¥
- æ¯ä¸ªå·¥ä½œæµçš„è™šæ‹Ÿæ—¶é’Ÿä»0:00å¼€å§‹
- éšç€ä»»åŠ¡åˆ†é…ï¼Œè™šæ‹Ÿæ—¶é’Ÿæ¨è¿›
- ç¢³å¼ºåº¦æ ¹æ®è™šæ‹Ÿæ—¶é’Ÿæ—¶é—´åŠ¨æ€è®¡ç®—

### ä¸ecmwsçš„å·®å¼‚

| ç‰¹æ€§ | ecmws | paper1115 |
|------|-------|----------|
| **è°ƒåº¦æ¨¡å¼** | åŠ¨æ€åœ¨çº¿è°ƒåº¦ | ç¦»çº¿æ‰¹å¤„ç† |
| **æ—¶é’Ÿç³»ç»Ÿ** | å…¨å±€æ—¶é’Ÿ | å·¥ä½œæµè™šæ‹Ÿæ—¶é’Ÿ |
| **ç”µä»·/ç¢³å¼ºåº¦** | 24ç»´å‘é‡ï¼ˆ4DCÃ—6hï¼‰ | 1ç»´æ ‡é‡ï¼ˆå½“å‰æ—¶é—´ï¼‰ |
| **æ—¶é—´æ¨è¿›** | æ—¶é—´æ§½æ¨è¿› | ä»»åŠ¡å®Œæˆæ—¶æ¨è¿› |

### è®¾è®¡ä¼˜åŠ¿

1. **æœ€å°åŒ–æ¶æ„æ”¹åŠ¨**ï¼šåˆ©ç”¨ç°æœ‰çš„æ‰¹å¤„ç†æ¡†æ¶
2. **ç®€å•ç›´æ¥**ï¼šè™šæ‹Ÿæ—¶é’Ÿç®¡ç†ç®€å•æ˜äº†
3. **æ˜“äºæ‰©å±•**ï¼šä¸ºå¥–åŠ±å‡½æ•°é¢„ç•™äº†æ¸…æ™°çš„æ¥å£
4. **å…¼å®¹æ€§å¥½**ï¼šä¸å½±å“ç°æœ‰åŠŸèƒ½

---

## ğŸ’¡ å…³é”®æ¥å£è¯´æ˜

### 1. è·å–VMçš„ç¢³å¼ºåº¦

```python
# æ–¹æ³•1ï¼šé€šè¿‡VmObservation
vm_obs: VmObservation = obs.vm_observations[vm_id]
carbon_intensity = vm_obs.get_carbon_intensity_at(time_seconds)

# æ–¹æ³•2ï¼šé€šè¿‡VmDto
vm_dto: VmDto = state.static_state.vms[vm_id]
carbon_intensity = vm_dto.get_carbon_intensity_at(time_seconds)

# æ–¹æ³•3ï¼šç›´æ¥è®¿é—®æ•°ç»„
carbon_intensity = vm_dto.host_carbon_intensity_curve[hour]
```

### 2. è®¡ç®—ç¢³æˆæœ¬

```python
# æ–¹æ³•1ï¼šä½¿ç”¨é¢„ç•™æ¥å£ï¼ˆæ¨èï¼‰
carbon_cost = obs.carbon_cost()

# æ–¹æ³•2ï¼šæ‰‹åŠ¨è®¡ç®—
carbon_cost = 0.0
for task_obs in obs.task_observations:
    if task_obs.assigned_vm_id is not None:
        vm_obs = obs.vm_observations[task_obs.assigned_vm_id]
        carbon_intensity = vm_obs.get_carbon_intensity_at(task_obs.start_time)
        carbon_cost += task_obs.energy_consumption * carbon_intensity
```

### 3. å·¥ä½œæµæ—¶é’Ÿç®¡ç†

```python
# åˆå§‹åŒ–æ—¶é’Ÿç®¡ç†å™¨
clock_manager = ClockManager()
clock_manager.initialize(workflows)

# è·å–å·¥ä½œæµæ—¶é’Ÿ
current_time = clock_manager.get_workflow_clock(workflow_id)

# æ¨è¿›æ—¶é’Ÿ
clock_manager.update_clock_for_task_completion(task_id, completion_time)
```

---

## ğŸ“Š ç‰¹å¾éªŒè¯

è¿è¡Œä»¥ä¸‹ä»£ç éªŒè¯ç‰¹å¾æ˜¯å¦æ­£ç¡®é›†æˆï¼š

```python
from scheduler.dataset_generator.core.gen_dataset import generate_dataset
from scheduler.rl_model.core.env.gym_env import CloudSchedulingGymEnvironment
from scheduler.rl_model.agents.gin_agent.wrapper import GinAgentWrapper

# ç”Ÿæˆæ•°æ®é›†
dataset = generate_dataset(
    seed=42,
    host_count=4,
    vm_count=15,
    workflow_count=3,
    dag_method='pegasus',
    task_length_dist='uniform',
    min_task_length=10000,
    max_task_length=100000,
    task_arrival='static',
    arrival_rate=1.0,
)

# åˆ›å»ºç¯å¢ƒ
env = CloudSchedulingGymEnvironment(dataset=dataset)
wrapped_env = GinAgentWrapper(env)

# é‡ç½®å¹¶æ£€æŸ¥
obs, info = wrapped_env.reset()
print(f"è§‚å¯Ÿç©ºé—´å½¢çŠ¶: {obs.shape}")

# æ‰§è¡Œæ­¥éª¤
action = wrapped_env.action_space.sample()
obs, reward, done, truncated, info = wrapped_env.step(action)
print(f"å¥–åŠ±: {reward}")
```

---

## âœ… å®ŒæˆçŠ¶æ€

- [x] ç¢³å¼ºåº¦æ•°æ®é…ç½®
- [x] Hostç”Ÿæˆé€»è¾‘ä¿®æ”¹
- [x] è™šæ‹Ÿæ—¶é’Ÿç®¡ç†
- [x] VMç‰¹å¾æ‰©å±•
- [x] GNNç‰¹å¾é›†æˆ
- [x] ç¢³æˆæœ¬è®¡ç®—æ¥å£
- [ ] å¥–åŠ±å‡½æ•°ä¿®æ”¹ï¼ˆå¾…åç»­å®ç°ï¼‰

---

## ğŸ“š ç›¸å…³æ–‡ä»¶ç´¢å¼•

- **é…ç½®æ–‡ä»¶**ï¼š`scheduler/config/carbon_intensity.py`
- **æ•°æ®æ¨¡å‹**ï¼š`scheduler/dataset_generator/core/models.py`
- **VMç”Ÿæˆ**ï¼š`scheduler/dataset_generator/core/gen_vm.py`
- **æ—¶é’Ÿç®¡ç†**ï¼š`scheduler/rl_model/core/env/clock_manager.py`
- **ç±»å‹å®šä¹‰**ï¼š`scheduler/rl_model/core/types.py`
- **è§‚å¯Ÿç©ºé—´**ï¼š`scheduler/rl_model/core/env/observation.py`
- **GNNä»£ç†**ï¼š`scheduler/rl_model/agents/gin_agent/`

